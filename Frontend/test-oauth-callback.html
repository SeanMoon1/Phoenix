<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OAuth ì½œë°± í…ŒìŠ¤íŠ¸</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .test-section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .test-button {
        background: #ff6b35;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      .test-button:hover {
        background: #e55a2b;
      }
      .result {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        border-left: 4px solid #ff6b35;
      }
      .error {
        border-left-color: #dc3545;
        background: #f8d7da;
      }
      .success {
        border-left-color: #28a745;
        background: #d4edda;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ”§ OAuth ì½œë°± í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>

    <div class="test-section">
      <h2>1. URL íŒŒë¼ë¯¸í„° í…ŒìŠ¤íŠ¸</h2>
      <p>ë‹¤ì–‘í•œ OAuth ì½œë°± URLì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”:</p>

      <button class="test-button" onclick="testSuccessCallback()">
        ì„±ê³µ ì½œë°± í…ŒìŠ¤íŠ¸
      </button>
      <button class="test-button" onclick="testErrorCallback()">
        ì—ëŸ¬ ì½œë°± í…ŒìŠ¤íŠ¸
      </button>
      <button class="test-button" onclick="testMissingDataCallback()">
        ëˆ„ë½ ë°ì´í„° í…ŒìŠ¤íŠ¸
      </button>
      <button class="test-button" onclick="testInvalidDataCallback()">
        ì˜ëª»ëœ ë°ì´í„° í…ŒìŠ¤íŠ¸
      </button>

      <div id="url-result" class="result" style="display: none"></div>
    </div>

    <div class="test-section">
      <h2>2. ì¸ì¦ ìŠ¤í† ì–´ ìƒíƒœ í…ŒìŠ¤íŠ¸</h2>
      <p>Zustand ì¸ì¦ ìŠ¤í† ì–´ì˜ ìƒíƒœ ê´€ë¦¬ë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤:</p>

      <button class="test-button" onclick="testSetAuth()">
        ì¸ì¦ ìƒíƒœ ì„¤ì •
      </button>
      <button class="test-button" onclick="testClearAuth()">
        ì¸ì¦ ìƒíƒœ ì´ˆê¸°í™”
      </button>
      <button class="test-button" onclick="testGetAuthState()">
        í˜„ì¬ ì¸ì¦ ìƒíƒœ í™•ì¸
      </button>

      <div id="store-result" class="result" style="display: none"></div>
    </div>

    <div class="test-section">
      <h2>3. Google OAuth ë²„íŠ¼ í´ë¦­ í…ŒìŠ¤íŠ¸</h2>
      <p>Google OAuth ë²„íŠ¼ í´ë¦­ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸ URLì„ í™•ì¸í•©ë‹ˆë‹¤:</p>

      <button class="test-button" onclick="testGoogleOAuthRedirect()">
        Google OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ í…ŒìŠ¤íŠ¸
      </button>

      <div id="oauth-result" class="result" style="display: none"></div>
    </div>

    <div class="test-section">
      <h2>4. í™˜ê²½ë³€ìˆ˜ í…ŒìŠ¤íŠ¸</h2>
      <p>í”„ë¡ íŠ¸ì—”ë“œ í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì„ í™•ì¸í•©ë‹ˆë‹¤:</p>

      <button class="test-button" onclick="testEnvironmentVariables()">
        í™˜ê²½ë³€ìˆ˜ í™•ì¸
      </button>

      <div id="env-result" class="result" style="display: none"></div>
    </div>

    <script>
      // í…ŒìŠ¤íŠ¸ìš© ê°€ì§œ ì¸ì¦ ìŠ¤í† ì–´ (ì‹¤ì œ Zustand ìŠ¤í† ì–´ì™€ ìœ ì‚¬í•œ êµ¬ì¡°)
      const mockAuthStore = {
        user: null,
        token: null,
        isAuthenticated: false,
        isLoading: false,

        setAuth: function (authData) {
          this.user = authData.user;
          this.token = authData.token;
          this.isAuthenticated = authData.isAuthenticated;
          this.isLoading = false;
          console.log('ì¸ì¦ ìƒíƒœ ì„¤ì •ë¨:', authData);
        },

        clearAuth: function () {
          this.user = null;
          this.token = null;
          this.isAuthenticated = false;
          this.isLoading = false;
          console.log('ì¸ì¦ ìƒíƒœ ì´ˆê¸°í™”ë¨');
        },

        getState: function () {
          return {
            user: this.user,
            token: this.token,
            isAuthenticated: this.isAuthenticated,
            isLoading: this.isLoading,
          };
        },
      };

      function showResult(elementId, message, type = 'info') {
        const element = document.getElementById(elementId);
        element.style.display = 'block';
        element.className = `result ${type}`;
        element.innerHTML = message;
      }

      function testSuccessCallback() {
        const mockToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test.token';
        const mockUser = {
          id: 1,
          email: 'test@example.com',
          name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
          userLevel: 1,
          currentTier: 1,
        };

        const testUrl = `http://localhost:5173/auth/callback?token=${mockToken}&user=${encodeURIComponent(
          JSON.stringify(mockUser)
        )}`;

        showResult(
          'url-result',
          `
                <strong>ì„±ê³µ ì½œë°± URL í…ŒìŠ¤íŠ¸:</strong><br>
                <code>${testUrl}</code><br><br>
                <strong>íŒŒì‹±ëœ ë°ì´í„°:</strong><br>
                â€¢ í† í°: ${mockToken}<br>
                â€¢ ì‚¬ìš©ì: ${JSON.stringify(mockUser, null, 2)}
            `,
          'success'
        );
      }

      function testErrorCallback() {
        const testUrl =
          'http://localhost:5173/auth/callback?error=google_auth_failed';

        showResult(
          'url-result',
          `
                <strong>ì—ëŸ¬ ì½œë°± URL í…ŒìŠ¤íŠ¸:</strong><br>
                <code>${testUrl}</code><br><br>
                <strong>ì˜ˆìƒ ë™ì‘:</strong><br>
                â€¢ ì—ëŸ¬ íŒŒë¼ë¯¸í„° ê°ì§€<br>
                â€¢ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸<br>
                â€¢ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
            `,
          'error'
        );
      }

      function testMissingDataCallback() {
        const testUrl = 'http://localhost:5173/auth/callback';

        showResult(
          'url-result',
          `
                <strong>ëˆ„ë½ ë°ì´í„° ì½œë°± URL í…ŒìŠ¤íŠ¸:</strong><br>
                <code>${testUrl}</code><br><br>
                <strong>ì˜ˆìƒ ë™ì‘:</strong><br>
                â€¢ í† í° ë˜ëŠ” ì‚¬ìš©ì ì •ë³´ ì—†ìŒ ê°ì§€<br>
                â€¢ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸<br>
                â€¢ "missing_callback_data" ì—ëŸ¬
            `,
          'error'
        );
      }

      function testInvalidDataCallback() {
        const testUrl =
          'http://localhost:5173/auth/callback?token=invalid&user=invalid_json';

        showResult(
          'url-result',
          `
                <strong>ì˜ëª»ëœ ë°ì´í„° ì½œë°± URL í…ŒìŠ¤íŠ¸:</strong><br>
                <code>${testUrl}</code><br><br>
                <strong>ì˜ˆìƒ ë™ì‘:</strong><br>
                â€¢ JSON íŒŒì‹± ì‹¤íŒ¨<br>
                â€¢ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸<br>
                â€¢ "invalid_callback" ì—ëŸ¬
            `,
          'error'
        );
      }

      function testSetAuth() {
        const mockAuthData = {
          token: 'test_token_123',
          user: {
            id: 1,
            email: 'test@example.com',
            name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
            userLevel: 1,
            currentTier: 1,
          },
          isAuthenticated: true,
        };

        mockAuthStore.setAuth(mockAuthData);

        showResult(
          'store-result',
          `
                <strong>ì¸ì¦ ìƒíƒœ ì„¤ì • í…ŒìŠ¤íŠ¸:</strong><br>
                <pre>${JSON.stringify(mockAuthStore.getState(), null, 2)}</pre>
            `,
          'success'
        );
      }

      function testClearAuth() {
        mockAuthStore.clearAuth();

        showResult(
          'store-result',
          `
                <strong>ì¸ì¦ ìƒíƒœ ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸:</strong><br>
                <pre>${JSON.stringify(mockAuthStore.getState(), null, 2)}</pre>
            `,
          'success'
        );
      }

      function testGetAuthState() {
        const currentState = mockAuthStore.getState();

        showResult(
          'store-result',
          `
                <strong>í˜„ì¬ ì¸ì¦ ìƒíƒœ:</strong><br>
                <pre>${JSON.stringify(currentState, null, 2)}</pre>
            `,
          'info'
        );
      }

      function testGoogleOAuthRedirect() {
        const apiUrl = 'http://localhost:3000'; // ê¸°ë³¸ ë°±ì—”ë“œ URL
        const redirectUrl = `${apiUrl}/auth/google`;

        showResult(
          'oauth-result',
          `
                <strong>Google OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ í…ŒìŠ¤íŠ¸:</strong><br>
                <code>${redirectUrl}</code><br><br>
                <strong>ì˜ˆìƒ ë™ì‘:</strong><br>
                â€¢ Google OAuth í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸<br>
                â€¢ ì‚¬ìš©ì ì¸ì¦ í›„ ì½œë°± URLë¡œ ëŒì•„ì˜´<br>
                â€¢ ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•¨
            `,
          'info'
        );
      }

      function testEnvironmentVariables() {
        // Vite í™˜ê²½ë³€ìˆ˜ëŠ” ë¹Œë“œ ì‹œì ì— ê²°ì •ë˜ë¯€ë¡œ ëŸ°íƒ€ì„ì—ì„œëŠ” í™•ì¸í•˜ê¸° ì–´ë ¤ì›€
        // ëŒ€ì‹  ì¼ë°˜ì ì¸ í™˜ê²½ë³€ìˆ˜ë“¤ì„ í™•ì¸
        const envInfo = {
          NODE_ENV:
            typeof process !== 'undefined'
              ? process.env.NODE_ENV
              : 'ë¸Œë¼ìš°ì € í™˜ê²½',
          VITE_API_URL: 'ë¹Œë“œ ì‹œì ì— ê²°ì •ë¨',
          'í˜„ì¬ URL': window.location.href,
          'User Agent': navigator.userAgent,
        };

        showResult(
          'env-result',
          `
                <strong>í™˜ê²½ ì •ë³´:</strong><br>
                <pre>${JSON.stringify(envInfo, null, 2)}</pre><br>
                <strong>ì°¸ê³ :</strong> Vite í™˜ê²½ë³€ìˆ˜ëŠ” ë¹Œë“œ ì‹œì ì— ê²°ì •ë˜ë¯€ë¡œ, 
                ì‹¤ì œ í™˜ê²½ë³€ìˆ˜ëŠ” .env íŒŒì¼ê³¼ ë¹Œë“œ ì„¤ì •ì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
            `,
          'info'
        );
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ URL íŒŒë¼ë¯¸í„° í™•ì¸
      window.onload = function () {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.toString()) {
          showResult(
            'url-result',
            `
                    <strong>í˜„ì¬ URL íŒŒë¼ë¯¸í„°:</strong><br>
                    <code>${window.location.search}</code><br><br>
                    <strong>íŒŒì‹±ëœ íŒŒë¼ë¯¸í„°:</strong><br>
                    ${Array.from(urlParams.entries())
                      .map(([key, value]) => `â€¢ ${key}: ${value}`)
                      .join('<br>')}
                `,
            'info'
          );
        }
      };
    </script>
  </body>
</html>
